# 操作系统处理机调度

操作系统中的处理机调度是指根据一定的算法和策略，在多个进程之间进行切换，并决定哪个进程优先获得处理器的执行权。处理机调度是操作系统最基本的功能之一，它直接影响到系统的性能、并发度以及用户体验。

## 调度算法

### 先来先服务（FCFS）

先来先服务是最简单的调度算法之一，也被称为先到先服务或先进先出。按照进程到达时间顺序，先到达的进程先获得 CPU 的执行权，执行完毕后才会轮到下一个进程。这种调度算法的优点是公平性强，适用于长作业且不需要太多交互的场景。但是，如果存在短作业，则可能导致短作业需要等待长作业的执行，从而引起“饥饿”现象。

### 最短作业优先（SJF）

最短作业优先是一种非抢占式的调度算法，它会选择估计完成时间最短的进程优先分配 CPU 时间片。该算法可以有效地减少平均等待时间和周转时间，提高系统吞吐量。然而，它需要准确的作业长度信息，而这通常只有在进程执行时才能得到。如果估计不准确，可能会导致长作业永远无法获得 CPU 执行权。

### 优先级调度

优先级调度算法会为每个进程分配一个优先级，然后按照优先级高低来确定 CPU 时间片的分配。具有较高优先级的进程将获得更多的 CPU 时间，并在其他进程之前执行。该算法可以根据应用需求和性质进行灵活配置，但是如果所有进程都具有相同的优先级，则可能会出现“饥饿”现象。

### 时间片轮转（RR）

时间片轮转算法是一种抢占式的调度算法，它会将 CPU 时间分成固定大小的时间片，并按照顺序为每个进程分配一个时间片。当时间片用完时，当前进程就会被挂起，等待下一次调度。该算法可以保证所有进程公平地获得 CPU 时间片，并且对于交互式进程和响应时间要求高的应用非常适合。但是，如果时间片过短，则会增加上下文切换的开销；如果时间片过长，则会增加响应时间。

## 调度策略

### 非抢占式调度

非抢占式调度指的是进程一旦获得 CPU 时间片后，就可以一直执行到结束或者主动释放 CPU。这种调度策略简单，容易实现，但是如果进程出现无限循环等问题，会导致整个系统的崩溃。

### 抢占式调度

抢占式调度则允许更高优先级的进程中断当前正在执行的低优先级进程，强制将 CPU 时间片分配给高优先级进程执行。这种调度策略可以有效地避免长时间占用 CPU 的进程阻塞其它进程的情况，但需要增加额外的开销来管理和维护进程状态。

## 结语

上述调度算法和策略各有优缺点，在实际应用



## 子进程并不共享父进程的pcb(process control block)。

当一个进程创建子进程时，操作系统会为子进程分配一个新的pcb，并将父进程的一些信息复制到子进程的pcb中，例如进程id、父进程id、打开文件描述符等。但是，子进程的pcb是一个**的数据结构，其余部分与父进程的pcb无关。

在子进程被创建后，它将执行新的代码段，拥有自己的栈和堆空间。因此，子进程和父进程之间没有共享任何内存或资源，除非使用显式的ipc(interprocess communication)机制来进行数据交换。

需要注意的是，子进程可以通过系统调用获取父进程的pid以及其他信息。同时，子进程的pcb中还会维护指向父进程pcb的指针，这使得子进程可以方便地访问父进程的相关信息。



## 线程是在进程内部创建和管理的，因此线程和父进程共享相同的进程控制块（pcb）。

在一个进程中，所有的线程都使用相同的地址空间和其他资源，如打开的文件、信号处理程序等。因此，线程之间可以直接访问共享的数据，这也是线程编程中需要注意的重要问题之一。

另外，由于线程共享进程的pcb，因此所有线程都可以访问进程级别的资源，例如进程状态、优先级等。但是，线程也有自己的局部状态，例如线程id、寄存器值等，这些信息会被保存在线程栈中，并且每个线程都有自己的栈空间。

## 分级调度和作业调度是操作系统中常见的两种调度方式。

分级调度（multilevel feedback queue scheduling）是一种基于多个队列的调度算法，每个队列有不同的优先级，用于处理不同种类的进程。在这种调度算法中，新到来的进程首先被放入最高优先级队列。如果进程运行时间过长或者优先级较低，则会被移动到更低优先级的队列上，以给更多优先级更高的进程机会。这种调度算法可以避免饥饿现象，但需要考虑如何设置各个队列之间的参数。

而作业调度（job scheduling）是指操作系统对提交的任务进行排序并按照优先级进行处理的过程。该过程通常是在作业进入系统时进行排队的。在作业调度中，操作系统会根据作业的类型、大小、优先级等因素进行调度，以保证系统资源得到最优化地利用。

总之，分级调度和作业调度都是操作系统中重要的调度机制，它们都能够有效地管理和调度多个进程，提高系统的性能和效率。